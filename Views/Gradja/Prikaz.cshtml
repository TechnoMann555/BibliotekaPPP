@model BibliotekaPPP.Models.BusinessObjects.GradjaBO

@{
	ViewData["Title"] = Model.Naslov;

	// Formiranje putanje ka slici naslovne strane gradje
	string putanjaNaslovne = ViewData["PutanjaNaslovnihStrana"]?.ToString() + "/" + Model.NaslovnaStranaPath;

	// Formiranje liste imena i prezimena autora koji ce se prikazati
	List<string> autori = new List<string>();
	foreach (AutorBO autorBO in Model.Autori)
	{
		autori.Add(autorBO.ImePrezime);
	}

	// Formiranje stringa izdavanja
	string izdavanje = $"{Model.Izdavanje?.NaseljeIzdavanja}, {Model.Izdavanje?.NazivIzdavaca}, {Model.Izdavanje?.GodinaIzdavanja}";
}

@section Stylesheets {
	<link href="~/css/biblioteka.css" rel="stylesheet" asp-append-version="true"/>
}

<div class="row">
	<div class="col-3 naslovna-strana-gradje">
		<img src="@putanjaNaslovne" />
	</div>
	<div class="col-6 d-flex flex-column justify-content-between">
		<div>
			<h2>@Model.Naslov</h2>
			<h5>@string.Join(", ", autori)</h5>
			<hr />
			<p class="gradja-opis">@Model.Opis</p>
		</div>
		<div>
			<hr />
			<p><span class="fw-bold">Izdavanje: </span>@izdavanje</p>
			<p><span class="fw-bold">ISBN: </span>@Model.Isbn</p>
			<p><span class="fw-bold">UDK: </span>@Model.Udk</p>
		</div>
	</div>
	@if(ViewBag.Korisnik != null)
	{
		if(ViewBag.Korisnik.Uloga == "Korisnik_Clan")
		{
			if(ViewBag.GradjaProcitana == true)
			{
				int ocena = (Model.Ocena != null) ? Model.Ocena.Ocena : -1;

				<div class="col-3">
					<h3>Ocena pročitane građe</h3>
					<label for="ocena" class="form-label me-2">Ocena građe: </label>
					<select name="ocena" id="ocena" class="form-select w-auto d-inline" onchange="oceniGradju(@Model.GradjaId, this.value)">
						<!option value="" @((ocena == -1) ? "selected" : "")>-</!option>
						@for(int i = 1; i <= 10; i++)
						{
							<!option value="@i" @((ocena == i) ? "selected" : "") >@i</!option>
						}
					</select>
					<div id="rezultat-ocenjivanja" class="mt-3">

					</div>
				</div>
			}
		}
	}
</div>
@if (ViewBag.Korisnik != null)
{
	@section Scripts{
		@if (ViewBag.Korisnik.Uloga == "Korisnik_Clan")
		{
			if (ViewBag.GradjaProcitana == true)
			{
				<script type="text/javascript" asp-append-version="true">
					function oceniGradju(idGradje, ocena)
					{
						$.ajax({
							url: '@Url.Action("OceniGradju", "Ocena")',
							data: { gradjaID: idGradje, ocenaGradje: ocena },
							method: "POST",
							success: function(result) {
								$('#rezultat-ocenjivanja').html(result);
							}
						});
					}
				</script>
			}
		}
	}
}